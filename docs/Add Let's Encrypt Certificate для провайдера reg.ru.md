# Инструкция по созданию Let's Encrypt сертификата с DNS Challenge для провайдера reg.ru в Nginx Proxy Manager

---

## Предпосылки
- Доступ к Nginx Proxy Manager (NPM)
- Доступ к аккаунту reg.ru с правами управления DNS-записями
- API-ключ для управления DNS в reg.ru (если есть автоматическая интеграция)
- Нужно получить сертификат для `*.dfv24.com` (wildcard сертификат)

---

## Шаг 1. Получение API-ключа для reg.ru

1. Войдите в панель управления reg.ru  
2. Перейдите в раздел управления API (если поддерживается)  
3. Создайте или найдите API-ключ с правом редактирования DNS записей  
4. Сохраните API-ключ и секрет (Client ID и API Token)

---

## Шаг 2. Настройка Nginx Proxy Manager для использования DNS Challenge reg.ru

1. В админке NPM перейдите в **SSL Certificates → Add SSL Certificate**  
2. Выберите **Let's Encrypt** -> **DNS Challenge**  
3. В поле **Provider** выберите `reg_ru` или `custom` (если провайдера нет, потребуется писать скрипт)  
4. В поля API впишите необходимые параметры:  
   - Client ID  
   - API Token  
5. В поле **Domain Names** укажите:  
   `*.dfv24.com` (для wildcard сертификата)  
   и основной домен `dfv24.com`  
6. Включите остальные опции (Terms of Service, Email)  
7. Нажмите **Save** для запроса сертификата  
8. NPM автоматически добавит DNS TXT-записи для подтверждения владения доменом через API reg.ru

---

## Шаг 3. Проверка и автоматическое продление

- После успешного создания сертификата NPM будет автоматически обновлять его через DNS Challenge.  
- Для успешного продления важно, чтобы API-ключ был действующим, а NPM имел доступ к DNS управлению.

---

## Если в NPM нет готовой интеграции с reg.ru

- Используйте внешний скрипт для обновления TXT записей DNS в reg.ru, настраиваемый в NPM через **Custom DNS Provider**.  
- Нужна настройка curl-запросов к API reg.ru для добавления/удаления TXT записей.

---

# Итог

Для wildcard сертификатов Let's Encrypt у reg.ru необходимо использовать DNS Challenge, используя API провайдера для автоматического управления DNS записями.  
В Nginx Proxy Manager настройте DNS Challenge с учётом особенностей reg.ru для бесшовного получения и продления сертификатов.
