# Подробная инструкция по настройке Nginx Proxy Manager с одним глобальным SSL сертификатом для всех доменов dfv24.com

## Предпосылки
- Установлен и запущен [Nginx Proxy Manager](http://192.168.10.14:81/)
- Основной домен: dfv24.com
- Хостинг и DNS записи домена находятся на reg.ru
- Нужно использовать один SSL сертификат (например, wildcard) для всех поддоменов dfv24.com

---

## Шаг 1. Покупка и получение SSL Wildcard сертификата для dfv24.com
1. На reg.ru или любом другом удостоверяющем центре (CA) закажите wildcard сертификат на домен вида `*.dfv24.com`.
2. Получите файлы сертификата:  
   - Главный сертификат (CRT)  
   - Промежуточные сертификаты (CA Bundle)  
   - Приватный ключ (KEY)

---

## Шаг 2. Импорт вашего SSL сертификата в Nginx Proxy Manager
1. Авторизуйтесь в Nginx Proxy Manager на http://192.168.10.14:81/  
2. Перейдите в раздел **SSL Certificates** → кнопку **Add SSL Certificate**  
3. Выберите **Custom** (пользовательский сертификат)  
4. В поля вставьте:  
   - **Certificate** — основной CRT + CA Bundle (если CA Bundle раздельно, склейте в один файл или вставляйте последовательно)  
   - **Key** — содержимое приватного ключа  
   - Имя сертификата задайте, например, `dfv24_wildcard`  
5. Сохраните

---

## Шаг 3. Настройка прокси-хостов с использованием глобального сертификата

1. Перейдите в **Proxy Hosts** → **Add Proxy Host**  
2. Заполните поля:  
   - **Domain Names**: Например, `sub1.dfv24.com` (для первого поддомена)  
   - **Scheme**: http или https, в зависимости от бекенда  
   - **Forward Hostname / IP**: IP или DNS адрес вашего внутреннего сервиса  
   - **Forward Port**: порт сервиса (например, 80 или 443)  
3. Включите **SSL** → Отметьте **Use a shared SSL certificate** (если такая опция доступна) или выберите ранее импортированный сертификат из списка  
4. Активируйте: **Block Common Exploits**, **Websockets Support**, выставьте Redirect HTTP to HTTPS, если требуется  
5. Сохраните прокси-хост

6. Повторите для всех поддоменов, указывая нужные домены и выбирая тот же wildcard SSL сертификат

---

## Шаг 4. Настройка DNS записей на reg.ru

1. Войдите в панель управления доменом на reg.ru  
2. Создайте или отредактируйте DNS записи типа A:  
   - `dfv24.com` → IP вашего Nginx Proxy Manager (например, 192.168.10.14)  
   - `*.dfv24.com` → тот же IP или конкретные поддомены, если есть специальные  
3. Сохраните изменения  
4. Дождитесь обновления DNS (от нескольких минут до 24 часов)

---

## Шаг 5. Тест и проверка работы

1. В браузере откройте любой из поддоменов `https://sub1.dfv24.com`  
2. Сертификат должен быть валидным, выданным на wildcard `*.dfv24.com`  
3. Проверьте работу прокси и корректность подстановки сертификата  
4. При необходимости проверьте логи Nginx Proxy Manager и исправьте ошибки

---

## Дополнительно

- Если в Nginx Proxy Manager нет GUI опции выбора общего сертификата, можно вручную сконфигурировать конфиги через директорий `/data/nginx/proxy_host` и прописать SSL сертификат для всех хостов.  
- При обновлении сертификата — повторно импортировать его в Nginx Proxy Manager.  
- Можно использовать LetsEncrypt для автоматического получения wildcard сертификата с помощью DNS-валидации (если поддерживается вашим DNS-провайдером).

---

# Итог

Используйте один wildcard сертификат для всех поддоменов, импортируйте его как пользовательский сертификат в Nginx Proxy Manager, при создании прокси-хостов выбирайте его в настройках SSL. Управляйте DNS записями на reg.ru, направляя domен на IP Nginx Proxy Manager.  
Это позволит юридически использовать единый сертификат для всех сервисов с различными поддоменами под вашим доменом dfv24.com.
